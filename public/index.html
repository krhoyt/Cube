<html>
<head>

<title>Rubik's Cube Solver</title>

<style>
body {
  background-color: #f5f5f5;
} 

video {
  display: none;
}

#camera {
  position: relative;
}

#camera > canvas {
  position: absolute;
}

#camera > svg {
  position: absolute;
}

.template {
  display: none;
}
</style>

</head>
<body>

<div id="camera">

  <!-- Rendering surface -->
  <canvas width="640" height="480"></canvas>

  <!-- Modes -->
  <svg width="640" height="480">
    <defs>
      <!-- Masking -->
      <!-- 2x2x2 -->
      <mask id="two">
        <rect x="0" y="0" width="640" height="480" fill="white"></rect>        
        <rect x="182" y="102" width="130" height="130" rx="6" fill="black"></rect>
        <rect x="182" y="247" width="130" height="130" rx="6" fill="black"></rect>              
        <rect x="327" y="102" width="130" height="130" rx="6" fill="black"></rect>
        <rect x="327" y="247" width="130" height="130" rx="6" fill="black"></rect>      
      </mask>

      <!-- 3x3x3 -->
      <mask id="three">
        <rect x="0" y="0" width="640" height="480" fill="white"></rect>        
        <rect x="95" y="15" width="130" height="130" rx="6" fill="black"></rect>
        <rect x="95" y="175" width="130" height="130" rx="6" fill="black"></rect>      
        <rect x="95" y="335" width="130" height="130" rx="6" fill="black"></rect>
        <rect x="255" y="15" width="130" height="130" rx="6" fill="black"></rect>
        <rect x="255" y="175" width="130" height="130" rx="6" fill="black"></rect>      
        <rect x="255" y="335" width="130" height="130" rx="6" fill="black"></rect>                  
        <rect x="415" y="15" width="130" height="130" rx="6" fill="black"></rect>
        <rect x="415" y="175" width="130" height="130" rx="6" fill="black"></rect>      
        <rect x="415" y="335" width="130" height="130" rx="6" fill="black"></rect>
      </mask>      
    </defs>

    <!-- Apply -->
    <rect x="0" y="0" width="640" height="480" fill="rgba( 0, 0, 0, 0.20 )" style="mask: url( #three );"></rect>
  </svg>

</div>

<!-- Web camera -->
<!-- Not visible -->
<video width="640" height="480"></video>

<!-- Face template -->
<svg class="face template" width="93" height="93">
  <!-- Row -->
  <rect width="31" height="31" rx="4"></rect> 
  <rect class="cubies" x="2" y="2" width="27" height="27" rx="2" fill="lightgrey"></rect>
  <rect x="31" width="31" height="31" rx="4"></rect> 
  <rect class="cubies" x="33" y="2" width="27" height="27" rx="2" fill="lightgrey"></rect>  
  <rect x="62" width="31" height="31" rx="4"></rect> 
  <rect class="cubies" x="64" y="2" width="27" height="27" rx="2" fill="lightgrey"></rect>

  <!-- Row -->
  <rect y="30" width="31" height="31" rx="4"></rect> 
  <rect class="cubies" x="2" y="32" width="27" height="27" rx="2" fill="lightgrey"></rect>
  <rect x="31" y="30" width="31" height="31" rx="4"></rect> 
  <rect class="side" x="33" y="32" width="27" height="27" rx="2" fill="green"></rect>  
  <rect x="62" y="30" width="31" height="31" rx="4"></rect> 
  <rect class="cubies" x="64" y="32" width="27" height="27" rx="2" fill="lightgrey"></rect>    

  <!-- Row -->
  <rect y="60" width="31" height="31" rx="4"></rect> 
  <rect class="cubies" x="2" y="62" width="27" height="27" rx="2" fill="lightgrey"></rect>
  <rect x="31" y="60" width="31" height="31" rx="4"></rect> 
  <rect class="cubies" x="33" y="62" width="27" height="27" rx="2" fill="lightgrey"></rect>  
  <rect x="62" y="60" width="31" height="31" rx="4"></rect> 
  <rect class="cubies" x="64" y="62" width="27" height="27" rx="2" fill="lightgrey"></rect>      
</svg>

<script>
class Face {
  constructor( target, color = 'green' ) {
    this.pallete = {
      R: 'red', G: 'green', B: 'blue', W: 'white', O: 'orange', Y: 'yellow',
      yellow: 'Y', orange: 'O', white: 'W', blue: 'B', green: 'G', red: 'R'
    };

    let template = document.querySelector( '.face.template' );

    this.root = template.cloneNode( true );
    this.root.classList.remove( 'template' );
    target.appendChild( this.root );

    this.side = this.root.querySelector( '.side' );
    this.side.setAttributeNS( null, 'fill', color );

    this.cubies = this.root.querySelectorAll( '.cubies' );
  }

  set colors( value ) {
    value = value.toUpperCase();

    for( let c = 0; c < this.cubies.length; c++ ) {
      this.cubies[c].setAttributeNS( null, 'fill', this.pallete[value.charAt( c )] );
    }
  }

  get colors() {
    let result = '';

    for( let c = 0; c < this.cubies.length; c++ ) {
      if( c == 4 ) {
        result = result + this.pallete[this.side.getAttributeNS( null, 'fill' )];
      }

      result = result + this.pallete[this.cubies[c].getAttributeNS( null, 'fill' )];
    }

    return result;
  }
}

class Camera {
  constructor() {
    this.root = document.querySelector( '#camera' );
    
    this.canvas = this.root.querySelector( 'canvas' );
    this.context = this.canvas.getContext( '2d' );

    this.mode = this.root.querySelector( 'svg > rect' );

    this.video = document.querySelector( 'video' );

    /*
    navigator.mediaDevices.getUserMedia( {audio: false, video: true} )
      .then( ( stream ) => {
        // Set video to web camera
        this.video.srcObject = stream;
        
        // Wait for stream to start
        this.video.onloadedmetadata = function( evt ) {
          // Play the web camera video
          this.video.play();

          // Render to canvas
          this.render();
        }.bind( this );
      } ).catch( ( error ) => {
        console.log( error );
      } );
    */
  }

  render() {
    this.context.drawImage( this.video, 0, 0 );
    requestAnimationFrame( () => { return this.render(); } );        
  }  
}

class Solver {
  constructor() {
    this.camera = new Camera();
    this.faces = [
      new Face( document.body, 'green' ),
      new Face( document.body, 'red' ),
      new Face( document.body, 'blue' ),
      new Face( document.body, 'orange' ),
      new Face( document.body, 'white' ),
      new Face( document.body, 'yellow' )
    ];
    this.faces[0].colors = 'ROYGBWRO';
    console.log( this.faces[0].colors );
  }
}

// Application
let app = new Solver();
</script>

</body>
</html>
