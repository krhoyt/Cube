<html>
<head>

<title>Rubik's Cube Solver</title>

<style>
body {
  align-content: center;
  background-color: #fafafa;
  display: flex;
  flex-direction: row;
  justify-content: center;
  margin: 0;
  overflow: hidden;
  padding: 0;
} 

svg {
  left: 0;
  height: 480px;
  position: absolute;  
  top: 0;
  width: 640px;
}

#camera {
  height: 480px;
  position: relative;  
  width: 640px;
}

#cube {
  background-color: #fafafa;
  height: 480px;
  margin-left: 16px;
  position: relative;
  width: 368px;
}

#picker {  
  border-radius: 6px;
  display: none;
  grid-template-columns: auto auto;
  grid-template-rows: auto auto auto;
  left: 8px;
  overflow: hidden;
  position: absolute;
  top: 8px;
}
</style>

</head>
<body>

<!-- Camera -->
<!-- Cropped video -->
<!-- Mask overlay -->
<div id="camera">
  <video playsinline></video>
  <svg id="mask"></svg>
  <div id="picker"></div>  
</div>

<!-- Show cube colors -->
<!-- 3D or flat -->
<div id="cube"></div>  

<!-- ThreeJS -->
<script src="../lib/mrdoob/three.js"></script>
<script src="../lib/mrdoob/OrbitControls.js"></script>

<!-- TweenMax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/1.20.3/TweenMax.min.js"></script>

<!-- Color space conversion -->
<script src="lib/antimatter15/color.js"></script>

<!-- Application -->
<script src="script/mask.js"></script>
<script src="script/picker.js"></script>
<script src="script/prism.js"></script>
<script src="script/camera.js"></script>
<script src="script/cubicle.js"></script>

<script>
class Solver {
  constructor() {
    // Camera
    this.camera = new Camera();
    this.camera.start();

    this.cube = new Cubicle();

    // Load color palette
    fetch( 'data/pastel.json' )
      .then( ( response ) => { 
        // Parse JSON
        return response.json() 
      } )
      .then( ( data ) => {
        // Assign palette
        // Build cube
        this.cube.palette = data;
        this.cube.colorize( Cubicle.FRONT, 'ZZZZGZZZZ' );
        this.cube.colorize( Cubicle.RIGHT, 'ZZZZRZZZZ' );
        this.cube.colorize( Cubicle.BACK, 'ZZZZBZZZZ' );        
        this.cube.colorize( Cubicle.LEFT, 'ZZZZOZZZZ' );        
        this.cube.colorize( Cubicle.UP, 'ZZZZWZZZZ' );        
        this.cube.colorize( Cubicle.DOWN, 'ZZZZYZZZZ' );        

        // Reference colors
        this.camera.palette = data;
        this.camera.addEventListener( Camera.ANALYZE, ( evt ) => this.doAnalyze( evt ) );
      } );        
  }

  doAnalyze( evt ) {
    this.cube.colorize( Cubicle.FRONT, evt );
  }
}

let app = new Solver();
</script>

</body>
</html>
